import os
import logging
import asyncio
import requests
from aiogram import Bot, Dispatcher, F
from aiogram.enums import ParseMode
from aiogram.filters import CommandStart
from aiogram.types import Message, ReplyKeyboardMarkup, KeyboardButton
from aiogram.client.default import DefaultBotProperties
from dotenv import load_dotenv

# --- –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è ---
load_dotenv()

# --- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ---
BOT_TOKEN = os.getenv("BOT_TOKEN")
OPENROUTER_KEY = os.getenv("OPENROUTER_KEY")
SCHEDULE_URL = os.getenv("SCHEDULE_URL")
SITE_URL = os.getenv("SITE_URL")

COLLEGE_NAME_RU = "–ö–∞—Ä–∞–≥–∞–Ω–¥–∏–Ω—Å–∫–∏–π –∫–æ–ª–ª–µ–¥–∂ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ —Å–µ—Ä–≤–∏—Å–∞"
COLLEGE_NAME_KZ = "“ö–∞—Ä–∞“ì–∞–Ω–¥—ã —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è –∂”ô–Ω–µ —Å–µ—Ä–≤–∏—Å –∫–æ–ª–ª–µ–¥–∂—ñ –ö–ú“ö–ö"

# --- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ ---
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

# --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞ ---
bot = Bot(token=BOT_TOKEN, default=DefaultBotProperties(parse_mode=ParseMode.HTML))
dp = Dispatcher()

# --- –°–∏—Å—Ç–µ–º–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ (Prompt –¥–ª—è –ò–ò) ---
COLLEGE_RULES_RU = (
    "–¢—ã ‚Äî –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –ö–∞—Ä–∞–≥–∞–Ω–¥–∏–Ω—Å–∫–æ–≥–æ –∫–æ–ª–ª–µ–¥–∂–∞ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ —Å–µ—Ä–≤–∏—Å–∞ (–ö–ö–¢–∏–°). "
    "–û—Ç–≤–µ—á–∞–π —Ç–æ–ª—å–∫–æ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –∫–æ–ª–ª–µ–¥–∂–µ–º, –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ–º, –ø—Ä–∏—ë–º–æ–º, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º, "
    "—Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—è–º–∏, –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ –∏ —Å—Ç—É–¥–µ–Ω—á–µ—Å–∫–æ–π –∂–∏–∑–Ω—å—é. "
    "–ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –Ω–µ –∫–∞—Å–∞–µ—Ç—Å—è –∫–æ–ª–ª–µ–¥–∂–∞ ‚Äî –≤–µ–∂–ª–∏–≤–æ –æ—Ç–∫–∞–∂–∏—Å—å –æ—Ç–≤–µ—á–∞—Ç—å."
)
COLLEGE_RULES_KZ = (
    "–°–µ–Ω ‚Äî “ö–∞—Ä–∞“ì–∞–Ω–¥—ã —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è –∂”ô–Ω–µ —Å–µ—Ä–≤–∏—Å –∫–æ–ª–ª–µ–¥–∂—ñ–Ω—ñ“£ –≤–∏—Ä—Ç—É–∞–ª–¥—ã –∫”©–º–µ–∫—à—ñ—Å—ñ—Å—ñ“£. "
    "–¢–µ–∫ –∫–æ–ª–ª–µ–¥–∂–≥–µ, –æ“õ—É –ø—Ä–æ—Ü–µ—Å—ñ–Ω–µ, “õ–∞–±—ã–ª–¥–∞—É“ì–∞, –∫–µ—Å—Ç–µ–≥–µ, –º–∞–º–∞–Ω–¥—ã“õ—Ç–∞—Ä“ì–∞, "
    "–±–∞–π–ª–∞–Ω—ã—Å –ø–µ–Ω —Å—Ç—É–¥–µ–Ω—Ç—Ç—ñ–∫ ”©–º—ñ—Ä–≥–µ “õ–∞—Ç—ã—Å—Ç—ã —Å“±—Ä–∞“õ—Ç–∞—Ä“ì–∞ –∂–∞—É–∞–ø –±–µ—Ä. "
    "–ï–≥–µ—Ä —Å“±—Ä–∞“õ –∫–æ–ª–ª–µ–¥–∂–≥–µ “õ–∞—Ç—ã—Å—ã –±–æ–ª–º–∞—Å–∞ ‚Äî —Å—ã–ø–∞–π—ã —Ç“Ø—Ä–¥–µ –∂–∞—É–∞–ø –±–µ—Ä—É–¥–µ–Ω –±–∞—Å —Ç–∞—Ä—Ç."
)

# --- –°–æ—Å—Ç–æ—è–Ω–∏–µ —è–∑—ã–∫–∞ ---
user_lang = {}

# --- –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã ---
def get_main_keyboard(lang: str) -> ReplyKeyboardMarkup:
    if lang == "kz":
        buttons = [
            [KeyboardButton(text="üìÖ –°–∞–±–∞“õ –∫–µ—Å—Ç–µ—Å—ñ"), KeyboardButton(text="üéì “ö–∞–±—ã–ª–¥–∞—É –∫–æ–º–∏—Å—Å–∏—è—Å—ã")],
            [KeyboardButton(text="üìû –ë–∞–π–ª–∞–Ω—ã—Å"), KeyboardButton(text="‚è∞ “ö–æ“£—ã—Ä–∞—É –∫–µ—Å—Ç–µ—Å—ñ")],
            [KeyboardButton(text="üåê –¢—ñ–ª–¥—ñ –∞—É—ã—Å—Ç—ã—Ä—É")],
        ]
    else:
        buttons = [
            [KeyboardButton(text="üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ"), KeyboardButton(text="üéì –ü—Ä–∏—ë–º–Ω–∞—è –∫–æ–º–∏—Å—Å–∏—è")],
            [KeyboardButton(text="üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã"), KeyboardButton(text="‚è∞ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–≤–æ–Ω–∫–æ–≤")],
            [KeyboardButton(text="üåê –°–º–µ–Ω–∏—Ç—å —è–∑—ã–∫")],
        ]
    return ReplyKeyboardMarkup(keyboard=buttons, resize_keyboard=True)

# --- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ —á–µ—Ä–µ–∑ OpenRouter ---
async def generate_reply(prompt: str, lang: str) -> str:
    try:
        logger.info("üß† –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –≤ OpenRouter...")
        headers = {
            "Authorization": f"Bearer {OPENROUTER_KEY}",
            "Content-Type": "application/json",
            "X-Title": "KKTiS College Bot"
        }
        data = {
            "model": "meta-llama/llama-3-8b-instruct",
            "messages": [
                {"role": "system", "content": COLLEGE_RULES_KZ if lang == "kz" else COLLEGE_RULES_RU},
                {"role": "user", "content": prompt},
            ],
        }
        response = requests.post("https://openrouter.ai/api/v1/chat/completions", headers=headers, json=data, timeout=60)

        if response.status_code != 200:
            logger.error(f"‚ùå –û—à–∏–±–∫–∞ OpenRouter: {response.status_code} - {response.text}")
            return "‚ö†Ô∏è –°–µ—Ä–≤–µ—Ä —É–∞“õ—ã—Ç—à–∞ “õ–æ–ª –∂–µ—Ç—ñ–º—Å—ñ–∑." if lang == "kz" else "‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ OpenRouter API."

        return response.json()["choices"][0]["message"]["content"].strip()

    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å OpenRouter: {e}")
        return "“ö–∞—Ç–µ –æ—Ä—ã–Ω –∞–ª–¥—ã." if lang == "kz" else "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞."

# --- /start ---
@dp.message(CommandStart())
async def cmd_start(message: Message):
    lang = "ru"
    user_lang[message.from_user.id] = lang
    text = (
        f"üéì <b>{COLLEGE_NAME_RU}</b>\n\n"
        f"üëã –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, <b>{message.from_user.first_name}</b>!\n\n"
        f"–Ø ‚Äî –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –∫–æ–ª–ª–µ–¥–∂–∞. –í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª üëá"
    )
    await message.answer(text, reply_markup=get_main_keyboard(lang))

# --- –°–º–µ–Ω–∞ —è–∑—ã–∫–∞ ---
@dp.message(F.text.in_(["üåê –°–º–µ–Ω–∏—Ç—å —è–∑—ã–∫", "üåê –¢—ñ–ª–¥—ñ –∞—É—ã—Å—Ç—ã—Ä—É"]))
async def change_language(message: Message):
    current_lang = user_lang.get(message.from_user.id, "ru")
    new_lang = "kz" if current_lang == "ru" else "ru"
    user_lang[message.from_user.id] = new_lang

    if new_lang == "kz":
        text = f"üá∞üáø –¢—ñ–ª “õ–∞–∑–∞“õ —Ç—ñ–ª—ñ–Ω–µ –∞—É—ã—Å—Ç—ã—Ä—ã–ª–¥—ã.\n\nüéì <b>{COLLEGE_NAME_KZ}</b>\n–¢”©–º–µ–Ω–Ω–µ–Ω “õ–∞–∂–µ—Ç—Ç—ñ –±”©–ª—ñ–º–¥—ñ —Ç–∞“£–¥–∞“£—ã–∑ üëá"
    else:
        text = f"üá∑üá∫ –Ø–∑—ã–∫ –∏–∑–º–µ–Ω—ë–Ω –Ω–∞ —Ä—É—Å—Å–∫–∏–π.\n\nüéì <b>{COLLEGE_NAME_RU}</b>\n–í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–π —Ä–∞–∑–¥–µ–ª üëá"

    await message.answer(text, reply_markup=get_main_keyboard(new_lang))

# --- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ ---
@dp.message(F.text.in_(["üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ", "üìÖ –°–∞–±–∞“õ –∫–µ—Å—Ç–µ—Å—ñ"]))
async def show_schedule(message: Message):
    lang = user_lang.get(message.from_user.id, "ru")
    if lang == "kz":
        text = (
            "üìÖ <b>–°–∞–±–∞“õ –∫–µ—Å—Ç–µ—Å—ñ</b>\n\n"
            f"üîó <a href='{SCHEDULE_URL}'>–ö–µ—Å—Ç–µ–Ω—ñ –∞—à—É</a>\n\nüåê {SITE_URL}"
        )
    else:
        text = (
            "üìÖ <b>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–Ω—è—Ç–∏–π</b>\n\n"
            f"üîó <a href='{SCHEDULE_URL}'>–û—Ç–∫—Ä—ã—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</a>\n\nüåê {SITE_URL}"
        )
    await message.answer(text, parse_mode=ParseMode.HTML)

# --- –ö–æ–Ω—Ç–∞–∫—Ç—ã ---
@dp.message(F.text.in_(["üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã", "üìû –ë–∞–π–ª–∞–Ω—ã—Å"]))
async def show_contacts(message: Message):
    lang = user_lang.get(message.from_user.id, "ru")
    if lang == "kz":
        text = (
            "üìû <b>–ë–∞–π–ª–∞–Ω—ã—Å</b>\n“ö–∞—Ä–∞“ì–∞–Ω–¥—ã, –ó–∞—Ç–∞–µ–≤–∏—á –∫., 75\n‚òéÔ∏è 8-7212-37-58-44\n‚úâÔ∏è krg-koll-7092@bilim09.kz"
        )
    else:
        text = (
            "üìû <b>–ö–æ–Ω—Ç–∞–∫—Ç—ã:</b>\n–ö–∞—Ä–∞–≥–∞–Ω–¥–∞, —É–ª. –ó–∞—Ç–∞–µ–≤–∏—á–∞, 75\n‚òéÔ∏è 8-7212-37-58-44\n‚úâÔ∏è krg-koll-7092@bilim09.kz"
        )
    await message.answer(text, parse_mode=ParseMode.HTML)

# --- –ü—Ä–∏—ë–º–Ω–∞—è –∫–æ–º–∏—Å—Å–∏—è ---
@dp.message(F.text.in_(["üéì –ü—Ä–∏—ë–º–Ω–∞—è –∫–æ–º–∏—Å—Å–∏—è", "üéì “ö–∞–±—ã–ª–¥–∞—É –∫–æ–º–∏—Å—Å–∏—è—Å—ã"]))
async def show_admission(message: Message):
    lang = user_lang.get(message.from_user.id, "ru")
    if lang == "kz":
        text = (
            "üéì <b>“ö–ê–ë–´–õ–î–ê–£ –ö–û–ú–ò–°–°–ò–Ø–°–´</b>\n\n"
            "“ö–∞—Ä–∞“ì–∞–Ω–¥—ã —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è –∂”ô–Ω–µ —Å–µ—Ä–≤–∏—Å –∫–æ–ª–ª–µ–¥–∂—ñ –∫–µ–ª–µ—Å—ñ –º–∞–º–∞–Ω–¥—ã“õ—Ç–∞—Ä –±–æ–π—ã–Ω—à–∞ –æ“õ—É“ì–∞ —à–∞“õ—ã—Ä–∞–¥—ã:\n\n"
            "üíª –¶–∏—Ñ—Ä–ª—ã“õ —Ç–µ—Ö–Ω–∏–∫–∞ ‚Äî 11 —Å—ã–Ω—ã–ø –Ω–µ–≥—ñ–∑—ñ–Ω–¥–µ, 10 –∞–π\n"
            "‚úÇÔ∏è –®–∞—à—Ç–∞—Ä–∞–∑ ”©–Ω–µ—Ä—ñ ‚Äî 9 —Å—ã–Ω—ã–ø –Ω–µ–≥—ñ–∑—ñ–Ω–¥–µ, 2 –∂—ã–ª 10 –∞–π\n"
            "üëó –ö–∏—ñ–º ”©–Ω–¥—ñ—Ä—ñ—Å—ñ –∂”ô–Ω–µ “Ø–ª–≥—ñ–ª–µ—É ‚Äî 9 —Å—ã–Ω—ã–ø –Ω–µ–≥—ñ–∑—ñ–Ω–¥–µ, 2 –∂—ã–ª 10 –∞–π\n"
            "üßµ –¢—ñ–≥—ñ–Ω—à—ñ ‚Äî 9 —Å—ã–Ω—ã–ø –Ω–µ–≥—ñ–∑—ñ–Ω–¥–µ, 2 –∂—ã–ª 10 –∞–π\n"
            "üëû –ê—è“õ –∫–∏—ñ–º —ñ—Å—ñ ‚Äî –¢–∏–ü–û –Ω–µ–≥—ñ–∑—ñ–Ω–¥–µ, 10 –∞–π\n"
            "üíº –û—Ñ–∏—Å-–º–µ–Ω–µ–¥–∂–µ—Ä ‚Äî 11 —Å—ã–Ω—ã–ø –Ω–µ–≥—ñ–∑—ñ–Ω–¥–µ, 10 –∞–π\n\n"
            "üìã “ö–∞–∂–µ—Ç—Ç—ñ “õ“±–∂–∞—Ç—Ç–∞—Ä:\n1Ô∏è‚É£ ”®—Ç—ñ–Ω—ñ—à\n2Ô∏è‚É£ –ë—ñ–ª—ñ–º —Ç—É—Ä–∞–ª—ã “õ“±–∂–∞—Ç\n3Ô∏è‚É£ 3x4 —Ñ–æ—Ç–æ (4 –¥–∞–Ω–∞)\n4Ô∏è‚É£ 075–£ –º–µ–¥. –∞–Ω—ã“õ—Ç–∞–º–∞\n\n"
            "üìç “ö“±–∂–∞—Ç—Ç–∞—Ä “õ–∞–±—ã–ª–¥–∞—É –º–µ–∫–µ–Ω–∂–∞–π—ã: “ö–∞—Ä–∞“ì–∞–Ω–¥—ã “õ., –ó–∞—Ç–∞–µ–≤–∏—á –∫., 75\n"
            "üìû ”ò–º—ñ—Ä—Ö–∞–Ω–æ–≤–∞ –ú.–ê. ‚Äî 8-701-842-25-36\nüìû –ò—Å–∫–∞–∫–æ–≤–∞ –ì.–ö. ‚Äî 8-700-145-45-36\n‚è∞ –î—Å‚Äì–ñ–º: 08:00‚Äì17:00"
        )
    else:
        text = (
            "üéì <b>–ü–†–ò–Å–ú–ù–ê–Ø –ö–û–ú–ò–°–°–ò–Ø</b>\n\n"
            "–ö–∞—Ä–∞–≥–∞–Ω–¥–∏–Ω—Å–∫–∏–π –∫–æ–ª–ª–µ–¥–∂ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ —Å–µ—Ä–≤–∏—Å–∞ –ø—Ä–∏–≥–ª–∞—à–∞–µ—Ç –∞–±–∏—Ç—É—Ä–∏–µ–Ω—Ç–æ–≤ –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ –ø–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—è–º:\n\n"
            "üíª –¶–∏—Ñ—Ä–æ–≤–∞—è —Ç–µ—Ö–Ω–∏–∫–∞ ‚Äî –Ω–∞ –±–∞–∑–µ 11 –∫–ª., 10 –º–µ—Å.\n"
            "‚úÇÔ∏è –ü–∞—Ä–∏–∫–º–∞—Ö–µ—Ä—Å–∫–æ–µ –∏—Å–∫—É—Å—Å—Ç–≤–æ ‚Äî –Ω–∞ –±–∞–∑–µ 9 –∫–ª., 2 –≥. 10 –º–µ—Å.\n"
            "üëó –®–≤–µ–π–Ω–æ–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ –∏ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–¥–µ–∂–¥—ã ‚Äî 2 –≥. 10 –º–µ—Å.\n"
            "üßµ –ü–æ—Ä—Ç–Ω–æ–π ‚Äî 2 –≥. 10 –º–µ—Å.\n"
            "üëû –û–±—É–≤–Ω–æ–µ –¥–µ–ª–æ ‚Äî 10 –º–µ—Å.\n"
            "üíº –û—Ñ–∏—Å-–º–µ–Ω–µ–¥–∂–µ—Ä ‚Äî 10 –º–µ—Å.\n\n"
            "üìã –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:\n1Ô∏è‚É£ –ó–∞—è–≤–ª–µ–Ω–∏–µ\n2Ô∏è‚É£ –î–æ–∫—É–º–µ–Ω—Ç –æ–± –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏\n3Ô∏è‚É£ –§–æ—Ç–æ 3√ó4 (4 —à—Ç.)\n4Ô∏è‚É£ –ú–µ–¥—Å–ø—Ä–∞–≤–∫–∞ 075–£\n\n"
            "üìç –ü—Ä–∏—ë–º –ø–æ –∞–¥—Ä–µ—Å—É: –≥. –ö–∞—Ä–∞–≥–∞–Ω–¥–∞, —É–ª. –ó–∞—Ç–∞–µ–≤–∏—á–∞, 75\n"
            "üìû ”ò–º—ñ—Ä—Ö–∞–Ω–æ–≤–∞ –ú.–ê. ‚Äî 8-701-842-25-36\nüìû –ò—Å–∫–∞–∫–æ–≤–∞ –ì.–ö. ‚Äî 8-700-145-45-36\n‚è∞ –ü–Ω‚Äì–ü—Ç: 08:00‚Äì17:00"
        )
    await message.answer(text, parse_mode=ParseMode.HTML)

# --- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–≤–æ–Ω–∫–æ–≤ ---
@dp.message(F.text.in_(["‚è∞ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–≤–æ–Ω–∫–æ–≤", "‚è∞ “ö–æ“£—ã—Ä–∞—É –∫–µ—Å—Ç–µ—Å—ñ"]))
async def show_bell_schedule(message: Message):
    lang = user_lang.get(message.from_user.id, "ru")
    if lang == "kz":
        text = (
            "<b>‚è∞ “ö–æ“£—ã—Ä–∞—É –∫–µ—Å—Ç–µ—Å—ñ</b>\n\n"
            "<b>–î“Ø–π—Å–µ–Ω–±—ñ:</b>\n"
            "–ö—É—Ä–∞—Ç–æ—Ä–ª—ã“õ —Å–∞“ì–∞—Ç ‚Äî 09:00 ‚Äì 09:45\n"
            "“Æ–∑—ñ–ª—ñ—Å ‚Äî 5 –º–∏–Ω\n"
            "1-–ø–∞—Ä–∞ ‚Äî 09:50 ‚Äì 11:20\n\n"
            "–¢“Ø—Å–∫—ñ –∞—Å (1-–∞“ì—ã–Ω) ‚Äî 20 –º–∏–Ω\n"
            "2-–ø–∞—Ä–∞ ‚Äî 11:40 ‚Äì 13:10\n\n"
            "–¢“Ø—Å–∫—ñ –∞—Å (2-–∞“ì—ã–Ω) ‚Äî 20 –º–∏–Ω\n"
            "3-–ø–∞—Ä–∞ ‚Äî 13:30 ‚Äì 15:00\n\n"
            "‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî\n"
            "<b>–°–µ–π—Å–µ–Ω–±—ñ ‚Äì –ñ“±–º–∞:</b>\n"
            "1-–ø–∞—Ä–∞ ‚Äî 09:00 ‚Äì 10:30\n"
            "“Æ–∑—ñ–ª—ñ—Å ‚Äî 10 –º–∏–Ω\n"
            "2-–ø–∞—Ä–∞ ‚Äî 10:40 ‚Äì 12:10\n\n"
            "–¢“Ø—Å–∫—ñ –∞—Å (1-–∞“ì—ã–Ω) ‚Äî 20 –º–∏–Ω\n"
            "3-–ø–∞—Ä–∞ ‚Äî 12:30 ‚Äì 14:00\n\n"
            "–¢“Ø—Å–∫—ñ –∞—Å (2-–∞“ì—ã–Ω) ‚Äî 20 –º–∏–Ω\n"
            "4-–ø–∞—Ä–∞ ‚Äî 14:20 ‚Äì 15:50"
        )
    else:
        text = (
            "<b>‚è∞ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–≤–æ–Ω–∫–æ–≤</b>\n\n"
            "<b>–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫:</b>\n"
            "–ö—É—Ä–∞—Ç–æ—Ä—Å–∫–∏–π —á–∞—Å ‚Äî 09:00 ‚Äì 09:45\n"
            "–ü–µ—Ä–µ–º–µ–Ω–∞ ‚Äî 5 –º–∏–Ω\n"
            "1 –ø–∞—Ä–∞ ‚Äî 09:50 ‚Äì 11:20\n\n"
            "–û–±–µ–¥ (1-–π –ø–æ—Ç–æ–∫) ‚Äî 20 –º–∏–Ω\n"
            "2 –ø–∞—Ä–∞ ‚Äî 11:40 ‚Äì 13:10\n\n"
            "–û–±–µ–¥ (2-–π –ø–æ—Ç–æ–∫) ‚Äî 20 –º–∏–Ω\n"
            "3 –ø–∞—Ä–∞ ‚Äî 13:30 ‚Äì 15:00\n\n"
            "‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî\n"
            "<b>–í—Ç–æ—Ä–Ω–∏–∫ ‚Äì –ü—è—Ç–Ω–∏—Ü–∞:</b>\n"
            "1 –ø–∞—Ä–∞ ‚Äî 09:00 ‚Äì 10:30\n"
            "–ü–µ—Ä–µ–º–µ–Ω–∞ ‚Äî 10 –º–∏–Ω\n"
            "2 –ø–∞—Ä–∞ ‚Äî 10:40 ‚Äì 12:10\n\n"
            "–û–±–µ–¥ (1-–π –ø–æ—Ç–æ–∫) ‚Äî 20 –º–∏–Ω\n"
            "3 –ø–∞—Ä–∞ ‚Äî 12:30 ‚Äì 14:00\n\n"
            "–û–±–µ–¥ (2-–π –ø–æ—Ç–æ–∫) ‚Äî 20 –º–∏–Ω\n"
            "4 –ø–∞—Ä–∞ ‚Äî 14:20 ‚Äì 15:50"
        )
    await message.answer(text, parse_mode=ParseMode.HTML)

# --- –ß–∞—Ç —Å –ò–ò ---
@dp.message()
async def chat(message: Message):
    lang = user_lang.get(message.from_user.id, "ru")
    prompt = message.text
    reply = await generate_reply(prompt, lang)
    await message.answer(reply)

# --- –û—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ø—É—Å–∫ ---
async def main():
    logger.info("‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!")
    await dp.start_polling(bot)

if __name__ == "__main__":
    asyncio.run(main())
